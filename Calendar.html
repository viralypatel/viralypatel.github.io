
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scrollable Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 12px;
  }

  .calendar {
    max-width: 1200px;
    margin: auto;
  }

  .topbar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  button {
    padding: 6px 10px;
    cursor: pointer;
  }

  .year-container {
    height: 80vh;
    overflow-y: auto;
  }

  .year {
    margin-bottom: 24px;
  }

  .year-title {
    font-size: 1.4em;
    margin: 8px 0;
  }

  .year-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 12px;
  }

  .month {
    border: 1px solid #ddd;
    padding: 6px;
  }

  .month-title {
    text-align: center;
    font-weight: bold;
    cursor: pointer;
    margin-bottom: 4px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.75em;
  }

  th, td {
    border: 1px solid #eee;
    padding: 3px;
    text-align: center;
  }

  th {
    background: #f4f4f4;
  }

  .week {
    background: #fafafa;
    color: #666;
    font-size: 0.7em;
  }

  .today {
    background: #4caf50;
    color: white;
    font-weight: bold;
  }

  .selected {
    outline: 2px solid #2196f3;
  }

  .hidden {
    display: none;
  }

  .month-scroll {
    height: 80vh;
    overflow-y: auto;
  }
</style>
</head>
<body>

<div class="calendar">
  <div class="topbar">
    <button onclick="showYearView()">Year view</button>
    <button onclick="goToday()">Today</button>
  </div>

  <div id="yearView" class="year-container"></div>
  <div id="monthView" class="month-scroll hidden"></div>
</div>

<script>
let view = "year";
let selectedDate = null;
let today = new Date();
let startYear = today.getFullYear() - 1;
let endYear = today.getFullYear() + 1;

function goToday() {
  selectedDate = new Date();
  showYearView();
  scrollToYear(today.getFullYear());
}

function showYearView() {
  view = "year";
  document.getElementById("monthView").classList.add("hidden");
  document.getElementById("yearView").classList.remove("hidden");
}

function showMonthView(year, month) {
  view = "month";
  const container = document.getElementById("monthView");
  container.innerHTML = "";
  container.classList.remove("hidden");
  document.getElementById("yearView").classList.add("hidden");

  let baseDate = new Date(year, month, 1);
  for (let i = -6; i <= 6; i++) {
    const d = new Date(baseDate.getFullYear(), baseDate.getMonth() + i, 1);
    container.appendChild(renderFullMonth(d.getFullYear(), d.getMonth()));
  }

  container.scrollTop = container.scrollHeight / 2;
  container.onscroll = () => handleMonthScroll(container);
}

function handleMonthScroll(container) {
  if (container.scrollTop < 200) {
    prependMonth(container);
  } else if (container.scrollTop + container.clientHeight > container.scrollHeight - 200) {
    appendMonth(container);
  }
}

function prependMonth(container) {
  const first = container.firstChild.dataset;
  const d = new Date(+first.year, +first.month - 1, 1);
  container.prepend(renderFullMonth(d.getFullYear(), d.getMonth()));
}

function appendMonth(container) {
  const last = container.lastChild.dataset;
  const d = new Date(+last.year, +last.month + 1, 1);
  container.appendChild(renderFullMonth(d.getFullYear(), d.getMonth()));
}

function scrollToYear(year) {
  const el = document.getElementById("year-" + year);
  if (el) el.scrollIntoView({ behavior: "smooth" });
}

function getWeekNumber(date) {
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const dayNum = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
  return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
}

function renderMonthTable(year, month) {
  const table = document.createElement("table");
  table.dataset.year = year;
  table.dataset.month = month;

  const thead = document.createElement("thead");
  thead.innerHTML = "<tr><th>Wk</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th><th>Su</th></tr>";
  table.appendChild(thead);

  const tbody = document.createElement("tbody");
  const firstDay = new Date(year, month, 1);
  const startDay = (firstDay.getDay() + 6) % 7;
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  let row = document.createElement("tr");
  let weekDate = new Date(year, month, 1 - startDay);
  let weekCell = document.createElement("td");
  weekCell.className = "week";
  weekCell.textContent = getWeekNumber(weekDate);
  row.appendChild(weekCell);

  for (let i = 0; i < startDay; i++) row.appendChild(document.createElement("td"));

  for (let day = 1; day <= daysInMonth; day++) {
    const date = new Date(year, month, day);
    const cell = document.createElement("td");
    cell.textContent = day;

    if (date.toDateString() === today.toDateString()) cell.classList.add("today");
    if (selectedDate && date.toDateString() === selectedDate.toDateString()) cell.classList.add("selected");

    cell.onclick = (e) => {
      selectedDate = date;
      e.stopPropagation();
    };

    row.appendChild(cell);

    if ((startDay + day) % 7 === 0) {
      tbody.appendChild(row);
      row = document.createElement("tr");
      weekDate.setDate(weekDate.getDate() + 7);
      weekCell = document.createElement("td");
      weekCell.className = "week";
      weekCell.textContent = getWeekNumber(weekDate);
      row.appendChild(weekCell);
    }
  }

  if (row.children.length > 1) tbody.appendChild(row);
  table.appendChild(tbody);
  return table;
}

function renderFullMonth(year, month) {
  const wrapper = document.createElement("div");
  wrapper.className = "month";
  wrapper.dataset.year = year;
  wrapper.dataset.month = month;

  const title = document.createElement("div");
  title.className = "month-title";
  title.textContent = new Date(year, month).toLocaleString("default", { month: "long", year: "numeric" });
  title.onclick = () => showMonthView(year, month);

  wrapper.appendChild(title);
  wrapper.appendChild(renderMonthTable(year, month));
  return wrapper;
}

function renderYear(year) {
  const container = document.createElement("div");
  container.className = "year";
  container.id = "year-" + year;

  const title = document.createElement("div");
  title.className = "year-title";
  title.textContent = year;
  container.appendChild(title);

  const grid = document.createElement("div");
  grid.className = "year-grid";

  for (let m = 0; m < 12; m++) {
    const month = document.createElement("div");
    month.className = "month";

    const name = document.createElement("div");
    name.className = "month-title";
    name.textContent = new Date(year, m).toLocaleString("default", { month: "long" });
    name.onclick = () => showMonthView(year, m);

    month.appendChild(name);
    month.appendChild(renderMonthTable(year, m));
    grid.appendChild(month);
  }

  container.appendChild(grid);
  return container;
}

function loadInitialYears() {
  const container = document.getElementById("yearView");
  for (let y = startYear; y <= endYear; y++) {
    container.appendChild(renderYear(y));
  }

  container.onscroll = () => {
    if (container.scrollTop < 300) {
      prependYear(container);
    } else if (container.scrollTop + container.clientHeight > container.scrollHeight - 300) {
      appendYear(container);
    }
  };

  scrollToYear(today.getFullYear());
}

function prependYear(container) {
  startYear--;
  container.prepend(renderYear(startYear));
}

function appendYear(container) {
  endYear++;
  container.appendChild(renderYear(endYear));
}

loadInitialYears();
</script>

</body>
</html>
